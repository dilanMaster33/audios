<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            background: #1a0b1f;
            color: #ff6b8b;
            font-family: 'Georgia', serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            text-align: center;
        }
        canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
        }
        #poema {
            font-size: 1.8em;
            white-space: pre-line;
            text-shadow: 0 0 10px rgba(255, 107, 139, 0.5);
            position: relative;
            z-index: 2;
            max-width: 90%;
        }
        .cursor {
            animation: parpadeo 0.8s infinite;
        }
        @keyframes parpadeo {
            0%,100%{opacity:1;}
            50%{opacity:.3;}
        }
        #gif-ventana {
            position: absolute;
            right: 5vw;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 22vw;
            min-width: 120px;
            max-width: 180px;
            height: auto;
        }
        .marco-lado {
            background: linear-gradient(135deg, #fff 70%, #e3c6ff 100%);
            width: 1.8vw;
            min-width: 12px;
            max-width: 18px;
            height: 90%;
            border-radius: 8px;
            box-shadow: 0 0 8px #fff8, 0 0 2px #e3c6ff;
            margin: 0 0.3vw;
        }
        #gif-disparador {
            position: static;
            width: 18vw;
            min-width: 80px;
            max-width: 120px;
            height: auto;
            margin: 0;
            box-shadow: 0 0 12px #fff4, 0 0 2px #e3c6ff;
            border-radius: 10px;
            background: #1a0b1f;
        }
        @media (max-width: 600px) {
            #gif-ventana {
                width: 40vw;
                min-width: 80px;
                max-width: 120px;
                right: 2vw;
            }
            .marco-lado {
                width: 4vw;
                min-width: 8px;
                max-width: 14px;
            }
            #gif-disparador {
                width: 32vw;
                min-width: 60px;
                max-width: 90px;
            }
            #poema {
                font-size: 1.1em;
                max-width: 98%;
            }
        }
        .corazon {
            position: absolute;
            font-size: 20px;
            will-change: transform, opacity;
            z-index: 9;
        }
        @keyframes disparo-corazon {
            0%{opacity:.8;transform:translate(0,0) scale(1);}
            80%{opacity:1;transform:var(--trayectoria);}
            100%{opacity:0;transform:var(--trayectoria) scale(1.2);}
        }
        #gif-final {
            display: block;
            margin: 20px auto 0 auto;
            width: 20vw;
            max-width: 140px;
            height: auto;
        }
        #te-amo-final {
            font-size: 3em;
            color: #ff6b8b;
            font-weight: bold;
            margin-bottom: 0.2em;
            text-shadow: 0 0 30px #ff6b8b, 0 0 10px #fff;
            opacity: 0;
            transform: scale(0.7);
            animation: teAmoIn 2.5s cubic-bezier(.68,-0.55,.27,1.55) forwards, pulsoTeAmo 1.2s infinite alternate;
            z-index: 3;
            position: relative;
        }
        @keyframes teAmoIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes pulsoTeAmo {
            0% { text-shadow: 0 0 30px #ff6b8b, 0 0 10px #fff; transform: scale(1);}
            50% { text-shadow: 0 0 60px #ff6b8b, 0 0 20px #fff; transform: scale(1.08);}
            100% { text-shadow: 0 0 30px #ff6b8b, 0 0 10px #fff; transform: scale(1);}
        }
        .estrella-fugaz {
            position: fixed;
            top: 0;
            left: 0;
            width: 2px;
            height: 80px;
            background: linear-gradient(180deg, #fff, rgba(255,255,255,0));
            opacity: 0.8;
            z-index: 100;
            pointer-events: none;
            border-radius: 2px;
            animation: fugazAnim 1.1s linear forwards;
        }
        @keyframes fugazAnim {
            0% { opacity: 0; transform: translate(var(--xstart),var(--ystart)) scaleY(0.7);}
            10% { opacity: 1;}
            90% { opacity: 1;}
            100% { opacity: 0; transform: translate(var(--xend),var(--yend)) scaleY(1);}
        }
        #pantalla-inicial {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: #1a0b1f;
            color: #ff6b8b;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: 'Georgia', serif;
            text-align: center;
        }
        #pantalla-inicial h1 {
            font-size: 2.2em;
            margin-bottom: 1em;
            text-shadow: 0 0 18px #ff6b8b, 0 0 8px #fff;
        }
        #pantalla-inicial button {
            font-size: 1.3em;
            padding: 0.7em 2em;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg,#ff6b8b 60%,#e3c6ff 100%);
            color: #1a0b1f;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 10px #ff6b8b88;
            transition: transform 0.2s;
        }
        #pantalla-inicial button:active {
            transform: scale(0.97);
        }
        @media (max-width: 600px) {
            #pantalla-inicial h1 { font-size: 1.3em; }
            #pantalla-inicial button { font-size: 1em; padding: 0.6em 1.2em; }
        }
    </style>
</head>
<body>
    <div id="pantalla-inicial">
        <h1>¡Hola!<br>¿Listo para sentir mi latido?</h1>
        <button id="btn-iniciar">Aprieta aquí</button>
    </div>
    <canvas id="estrellas"></canvas>
    <div id="poema"></div>

    <!-- ventana con marcos y gif -->
    <div id="gif-ventana">
        <div class="marco-lado"></div>
        <img id="gif-disparador" 
             src="https://github.com/Baque2005/public-files/blob/main/2025/Dise%C3%B1o%20sin%20t%C3%ADtulo%20(1).gif?raw=true" 
             alt="Disparador">
        <div class="marco-lado"></div>
    </div>

    <!-- audio autostart -->
    <audio id="audio-bg" src="https://dilanmaster33.github.io/audios/Rupatrupa%20-%20La%20Casa%20Verde.mp3" autoplay loop></audio>
    <script>
        // Fondo de estrellas animadas con movimiento diagonal
        function animarEstrellas(){
            const canvas=document.getElementById('estrellas');
            const ctx=canvas.getContext('2d');
            let w=window.innerWidth,h=window.innerHeight;
            canvas.width=w;canvas.height=h;
            let estrellas=[];
            for(let i=0;i<80;i++){
                estrellas.push({
                    x:Math.random()*w,
                    y:Math.random()*h,
                    r:Math.random()*1.5+.5,
                    a:Math.random()*Math.PI*2,
                    v:Math.random()*.02+.01,
                    dx:Math.random()*0.15+0.05, // velocidad x
                    dy:Math.random()*0.15+0.05  // velocidad y
                });
            }
            function dibujar(){
                ctx.clearRect(0,0,w,h);
                for(let e of estrellas){
                    e.a+=e.v;
                    e.x+=e.dx; e.y+=e.dy;
                    // Rebote en bordes
                    if(e.x>w) e.x=0;
                    if(e.y>h) e.y=0;
                    let b=Math.abs(Math.sin(e.a))*.7+.3;
                    ctx.beginPath();
                    ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
                    ctx.fillStyle=`rgba(255,255,255,${b})`;
                    ctx.shadowColor="#fff";ctx.shadowBlur=8*b;ctx.fill();
                }
                requestAnimationFrame(dibujar);
            }
            dibujar();
            window.addEventListener('resize',()=>{
                w=window.innerWidth;h=window.innerHeight;
                canvas.width=w;canvas.height=h;
            });
        }
        animarEstrellas();

        // Estrellas fugaces
        function lanzarEstrellaFugaz() {
            const w = window.innerWidth, h = window.innerHeight;
            const xstart = Math.random() * w * 0.8;
            const ystart = Math.random() * h * 0.3;
            const xend = xstart + 120 + Math.random() * 180;
            const yend = ystart + 180 + Math.random() * 120;
            const estrella = document.createElement('div');
            estrella.className = 'estrella-fugaz';
            estrella.style.setProperty('--xstart', `${xstart}px`);
            estrella.style.setProperty('--ystart', `${ystart}px`);
            estrella.style.setProperty('--xend', `${xend}px`);
            estrella.style.setProperty('--yend', `${yend}px`);
            document.body.appendChild(estrella);
            setTimeout(()=>estrella.remove(), 1200);
        }
        setInterval(lanzarEstrellaFugaz, 1800);

        const texto =
                    "Tu corazón tiene mareas\n" +
                    "que no siguen los calendarios\n" +
                    "y yo he aprendido\n" +
                    "a leer las señales del agua.\n\n" +
                    "Cuando te alejas\n" +
                    "no construyo faros\n" +
                    "para traerte de vuelta,\n" +
                    "solo dejo la ventana abierta\n" +
                    "y preparo café para dos\n" +
                    "por si acaso.\n\n" +
                    "La distancia no borra\n" +
                    "lo que crece despacio:\n" +
                    "estas ganas de cuidarte\n" +
                    "desde cualquier orilla.\n";
        let i=0,terminado=false;

        function getLetraPos(){
            const poema=document.getElementById('poema');
            const range=document.createRange();
            if(poema.childNodes.length>0){
                let node=poema.childNodes[0];
                if(node.nodeType===3){
                    range.setStart(node,node.length-1);
                    range.setEnd(node,node.length);
                }
                const rect=range.getBoundingClientRect();
                return {x:rect.left+rect.width/2,y:rect.top+rect.height/2};
            }
            const rect=poema.getBoundingClientRect();
            return {x:rect.left+rect.width/2,y:rect.top+rect.height/2};
        }

        function dispararCorazon(){
            const gif=document.getElementById('gif-disparador');
            const gifRect=gif.getBoundingClientRect();
            const destino=getLetraPos();
            const corazon=document.createElement('div');
            corazon.className='corazon';corazon.innerHTML='♥';
            corazon.style.color=`hsl(${Math.random()*30+330},80%,70%)`;
            corazon.style.left=`${gifRect.left+gifRect.width/2}px`;
            corazon.style.top=`${gifRect.top+gifRect.height/2}px`;
            const dx=destino.x-(gifRect.left+gifRect.width/2);
            const dy=destino.y-(gifRect.top+gifRect.height/2);
            corazon.style.setProperty('--trayectoria',`translate(${dx}px,${dy}px)`);
            corazon.style.animation='disparo-corazon 0.7s forwards';
            document.body.appendChild(corazon);
            setTimeout(()=>corazon.remove(),700);
        }

        // Función para reiniciar GIFs cada cierto tiempo
        function reiniciarGif(id, duracion){
            const gif=document.getElementById(id);
            setInterval(()=>{
                if(gif){
                    const src=gif.src.split('?')[0];
                    gif.src=src+'?t='+new Date().getTime();
                }
            }, duracion);
        }

        // Explosión de corazones al inicio
        function explosionCorazones() {
            const teAmo = document.getElementById('te-amo-inicio');
            const rect = teAmo.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;
            for (let i = 0; i < 18; i++) {
                const corazon = document.createElement('div');
                corazon.className = 'corazon-explosion';
                corazon.innerHTML = '♥';
                corazon.style.color = `hsl(${Math.random()*30+330},80%,70%)`;
                corazon.style.left = `${cx}px`;
                corazon.style.top = `${cy}px`;
                // Dirección aleatoria
                const ang = Math.random() * Math.PI * 2;
                const dist = 80 + Math.random() * 60;
                corazon.style.setProperty('--dx', `${Math.cos(ang)*dist}px`);
                corazon.style.setProperty('--dy', `${Math.sin(ang)*dist}px`);
                document.body.appendChild(corazon);
                setTimeout(()=>corazon.remove(),1200);
            }
        }

        // Explosión de corazones para el "Te amo" final
        function explosionCorazonesFinal() {
            const teAmo = document.getElementById('te-amo-final');
            const rect = teAmo.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;
            for (let i = 0; i < 18; i++) {
                const corazon = document.createElement('div');
                corazon.className = 'corazon-explosion';
                corazon.innerHTML = '♥';
                corazon.style.color = `hsl(${Math.random()*30+330},80%,70%)`;
                corazon.style.left = `${cx}px`;
                corazon.style.top = `${cy}px`;
                const ang = Math.random() * Math.PI * 2;
                const dist = 80 + Math.random() * 60;
                corazon.style.setProperty('--dx', `${Math.cos(ang)*dist}px`);
                corazon.style.setProperty('--dy', `${Math.sin(ang)*dist}px`);
                document.body.appendChild(corazon);
                setTimeout(()=>corazon.remove(),1200);
            }
        }

        // Oculta todo hasta que se presione el botón
        document.getElementById('pantalla-inicial').style.display = 'flex';
        document.getElementById('poema').style.display = 'none';
        document.getElementById('gif-ventana').style.display = 'none';

        document.getElementById('btn-iniciar').onclick = function() {
            document.getElementById('pantalla-inicial').style.display = 'none';
            document.getElementById('poema').style.display = '';
            document.getElementById('gif-ventana').style.display = '';
            document.getElementById('audio-bg').play(); 
            // Inicia animaciones y poema
            escribir();
        };

        function escribir(){
            if(i<texto.length){
                document.getElementById('poema').innerHTML=
                    texto.substring(0,i)+'<span class="cursor">❚</span>';
                dispararCorazon();i++;setTimeout(escribir,90);
            } else if(!terminado){
                terminado=true;
                document.getElementById('poema').innerHTML=
                  `<div id="te-amo-final">Mareas</div>
                   <div><img id='gif-final' src='https://i.pinimg.com/originals/56/5a/79/565a794512ed94e730f75f23c3ffc60f.gif' alt='Final' style='display:block;margin:20px auto;width:20vw;max-width:140px;'></div>
                   <div style="margin-top:1em;">${texto}</div>`;

                // animación y explosión de corazones para "Te amo"
                setTimeout(()=>{
                    document.getElementById('te-amo-final').style.opacity = 1;
                    explosionCorazonesFinal();
                }, 200);

                const gif=document.getElementById('gif-disparador');
                gif.style.opacity=0;
                setTimeout(()=>gif.style.display='none',600);

                const gifVentana=document.getElementById('gif-ventana');
                gifVentana.style.opacity=0;
                setTimeout(()=>gifVentana.style.display='none',600);

                reiniciarGif('gif-disparador', 3500);
                reiniciarGif('gif-final', 3500);

                setInterval(()=>{
                    const hue=Math.sin(Date.now()/2000)*30+330;
                    document.getElementById('poema').style.textShadow=`0 0 15px hsl(${hue},100%,70%)`;
                },50);
            }
        }
    </script>
</body>
</html>
